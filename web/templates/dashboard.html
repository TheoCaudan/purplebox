<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Purple Box Dashboard</title>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 1.5rem; }
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    h1 { margin-bottom: 0.5rem; }
    .card { border: 1px solid #eee; border-radius: 12px; padding: 1rem; box-shadow: 0 4px 14px rgba(0,0,0,.05); }
    ul { list-style: none; padding: 0; }
    li { padding: 0.25rem 0; border-bottom: 1px dotted #eee; }
    .tag { display:inline-block; padding:2px 6px; border-radius: 999px; background:#eee; margin-left:.5rem; font-size:.8rem;}
  </style>
</head>
<body>
  <h1>ðŸŸª Purple Box Dashboard</h1>
  <div class="grid">
    <div class="card">
      <h2>Events <span class="tag" id="count"></span></h2>
      <ul id="events">
        {% for e in events %}
        <li>[{{ e.source }}] {{ e.event_type }} ({{ e.attack_id }}) on {{ e.target }} @ {{ '%.0f' % e.timestamp }} â€” {{ e.details }}</li>
        {% endfor %}
      </ul>
    </div>
    <div class="card">
      <h2>Correlations</h2>
      <ul id="correlations"></ul>
    </div>
  </div>
  <script>
    const socket = io();
    function renderCorr() {
      fetch('/api/correlations').then(r=>r.json()).then(data=>{
        const ul = document.getElementById('correlations'); ul.innerHTML='';
        data.forEach(c=>{
          const li=document.createElement('li');
          li.textContent = `Attack ${c.attack_id} on ${c.target} detected after ${c.latency.toFixed(2)}s â€” ${c.detection_details}`;
          ul.appendChild(li);
        });
      });
    }
    function updateCount(){
      const n = document.querySelectorAll('#events li').length;
      document.getElementById('count').textContent = n;
    }
    socket.on('new_event', d => {
      const li = document.createElement('li');
      li.textContent = `[${d.source}] ${d.event_type} (${d.attack_id}) on ${d.target} @ ${Math.round(d.timestamp)} â€” ${d.details}`;
      const ul = document.getElementById('events');
      ul.prepend(li);
      updateCount();
      renderCorr();
    });
    updateCount();
    renderCorr();
  </script>
</body>
</html>
